# CVE-2024-20656 — Visual Studio VSStandardCollectorService150 LPE

## Summary
Visual Studio(2022 ≤ 17.8.3, 2019 ≤ 16.11.31)에 포함된 VSStandardCollectorService150 서비스가 **MSI Repair 과정에서 사용자 제어 경로를 로드**하면서 NT AUTHORITY\SYSTEM 권한으로 코드 실행이 가능한 로컬 권한 상승(LPE) 취약점.

## Root Cause
- MSI Repair 단계에서 **CollectorDirectory 레지스트리 경로**가 사용자 지정 경로로 변경 가능
- 서비스가 SYSTEM 권한으로 해당 경로의 DLL/EXE를 로드
- 경로 검증/ACL 제한이 Repair 과정에서 우회됨

## Exploit Flow
1. `HKLM\SOFTWARE\Microsoft\VSStandardCollector` 경로 값 변경
2. 공격자 경로에 payload.exe 배치
3. Visual Studio Installer에서 Modify → Repair 수행
4. 서비스가 payload 실행 → SYSTEM 획득

## Repro (요약)
```bat
reg add "HKLM\SOFTWARE\Microsoft\VSStandardCollector\Path" /t REG_SZ /d C:\Temp\evil
mkdir C:\Temp\evil & copy reverse.exe C:\Temp\evil
"C:\Program Files (x86)\Microsoft Visual Studio\Installer\vs_installer.exe" modify --repair
```

## Impact
- **Confidentiality/Integrity**: SYSTEM 권한으로 파일/레지스트리 접근 및 변경 가능
- **Availability**: 서비스 오작동/중지 유발 가능

## Mitigation
- 2024-01 패치 적용 (VS2022 17.8.4+, VS2019 16.11.32+)
- Collector 서비스 비활성화 또는 레지스트리 경로 ACL 강화
- MSI Repair 이벤트 모니터링

## Detection Ideas
- MSI Repair 이벤트(MsiInstaller 1033) 감시
- VSStandardCollectorService150 실행 경로가 비정상 위치로 향하는지 추적

## References
- MDSec 분석 보고서
- Microsoft Release Notes / MSRC
